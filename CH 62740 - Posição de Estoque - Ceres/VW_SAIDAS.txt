CREATE MATERIALIZED VIEW VW_SAIDAS REFRESH FORCE ON DEMAND START WITH SYSDATE NEXT SYSDATE + 5/24/60 AS
SELECT SA.SEQ_PLA_ENDERECO,
       SUM(DECODE(SI.QUANTIDADE,NULL,0,SI.QUANTIDADE)) AS SAIDAS,
       SA.COD_EMPRESA,
       SA.COD_FILIAL,
       SA.COD_SAFRA,
       SI.SEQ_PLA_ARMAZEM,
       SI.SEQ_PLA_PRODUTO,
       SA.DATA_EMISSAO AS DATA
  FROM AGRICOLA.EST_SAIDAS       SA,
       AGRICOLA.EST_SAIDAS_ROM   RS,
       AGRICOLA.EST_SAIDAS_ITENS SI,
       AGRICOLA.PRODUTOS         PD,
       AGRICOLA.SUB_GRUPO        SG
 WHERE NVL(RS.CANCELADO, 'N') <> 'S'
   AND NVL(RS.DEVOLVIDO, 'N') <> 'S'
   AND SA.SEQ_PLA_SAIDA        = RS.SEQ_PLA_SAIDA     (+)
   AND RS.SEQ_PLA_SAIDA        = SI.SEQ_PLA_SAIDA     (+)
   AND SI.SEQ_PLA_PRODUTO      = PD.SEQ_PLA_PRODUTO   (+)
   AND PD.SEQ_PLA_SUB_GRUPO    = SG.SEQ_PLA_SUB_GRUPO (+)
 GROUP BY SA.SEQ_PLA_ENDERECO,
       SA.COD_EMPRESA,
       SA.COD_FILIAL,
       SA.COD_SAFRA,
       SI.SEQ_PLA_ARMAZEM,
       SI.SEQ_PLA_PRODUTO,
       SA.DATA_EMISSAO
